<!-- File: index.html -->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Pond Volume Calculator (Simple)</title>
  <style>
    body{font-family:system-ui,Segoe UI,Arial;margin:0;background:#0b1220;color:#e7eefc}
    .wrap{max-width:980px;margin:0 auto;padding:18px}
    .card{background:#121c33;border:1px solid #263657;border-radius:14px;padding:16px;margin-bottom:14px}
    h1{margin:6px 0 2px;font-size:22px}
    h2{margin:10px 0 10px;font-size:15px}
    .muted{color:#a8b7d6}
    .grid2{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    @media(max-width:760px){.grid2{grid-template-columns:1fr}}
    label{display:block;font-size:12px;color:#a8b7d6;margin:6px 0}
    input,select{width:100%;padding:9px 10px;border-radius:10px;border:1px solid #263657;background:#0b1428;color:#e7eefc}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .row>*{flex:1}
    button{border:0;padding:10px 12px;border-radius:12px;background:#1f5eff;color:white;font-weight:800;cursor:pointer}
    .kpis{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-top:10px}
    @media(max-width:760px){.kpis{grid-template-columns:1fr}}
    .kpi{border:1px solid #263657;border-radius:12px;padding:10px;background:#0b1428}
    .kpi .t{font-size:11px;color:#a8b7d6}
    .kpi .v{font-size:16px;font-weight:900;margin-top:6px}
    .msg{margin-top:10px;padding:10px;border-radius:12px;border:1px solid #263657;background:#0b1428;color:#a8b7d6}
    .pass{color:#00e676;}
    .fail{color:#ff5252;}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Pond Volume Calculator (Simple)</h1>
    <p class="muted">User enters UPPER dimensions at Max WL. Calculator computes LOWER (bottom) dimensions from side slope and depth and shows them in summary.</p>

    <div class="card">
      <h2>1) Choose Required Volume Method</h2>
      <div class="row">
        <label style="flex:2">Method</label>
        <select id="mode">
          <option value="scs" selected>SCS Runoff Volume (Area + CN + Storm Depth)</option>
          <option value="inflow">Storm Inflow Volume (Triangular Qp/Tp/Tb)</option>
          <option value="vol">Direct Stormwater Volume (User Input m³)</option>
        </select>
      </div>

      <div id="scsBox" class="grid2">
        <div>
          <label>Drainage Area (ha)</label>
          <input id="areaHa" type="number" step="0.1" value="20">
        </div>
        <div>
          <label>Curve Number (CN)</label>
          <input id="cn" type="number" step="1" value="85" min="30" max="98">
        </div>
        <div>
          <label>Storm Depth P (mm)</label>
          <input id="pmm" type="number" step="1" value="50" min="0">
        </div>
        <div>
          <label>Loss factor (optional, %)</label>
          <input id="lossPct" type="number" step="1" value="0" min="0" max="50">
        </div>
      </div>

      <div id="inflowBox" class="grid2" style="display:none">
        <div>
          <label>Peak inflow Qp (m³/s)</label>
          <input id="qp" type="number" step="0.01" value="1.2" min="0">
        </div>
        <div>
          <label>Time to peak Tp (min)</label>
          <input id="tp" type="number" step="1" value="45" min="1">
        </div>
        <div>
          <label>Base duration Tb (min)</label>
          <input id="tb" type="number" step="1" value="180" min="1">
        </div>
        <div>
          <label>Loss factor (optional, %)</label>
          <input id="lossPct2" type="number" step="1" value="0" min="0" max="50">
        </div>
      </div>

      <div id="volBox" class="grid2" style="display:none">
        <div>
          <label>Required Stormwater Volume (m³)</label>
          <input id="vreqUser" type="number" step="1" value="500" min="0">
        </div>
        <div>
          <label>Loss factor (optional, %)</label>
          <input id="lossPct3" type="number" step="1" value="0" min="0" max="50">
        </div>
      </div>
    </div>

    <div class="card">
      <h2>2) Levels (Your Rules)</h2>
      <div class="grid2">
        <div>
          <label>Ground / Crest Level (EGL) (m)</label>
          <input id="egl" type="number" step="0.01" value="10.00">
        </div>
        <div>
          <label>Pipe Invert Level (IL) (m)</label>
          <input id="il" type="number" step="0.01" value="8.00">
        </div>
        <div>
          <label>Depth below IL (m) (min 0.30)</label>
          <input id="belowIL" type="number" step="0.01" value="0.30" min="0.30">
        </div>
        <div>
          <label>Freeboard (m)</label>
          <input id="fb" type="number" step="0.01" value="0.30" min="0">
        </div>
      </div>
      <p class="muted">Bottom = IL − depthBelowIL. Max WL = EGL − freeboard.</p>
    </div>

    <div class="card">
      <h2>3) Pond Geometry (Upper Dimensions Input)</h2>
      <div class="row">
        <label style="flex:2">Shape</label>
        <select id="shape">
          <option value="rect" selected>Rectangular (Upper L/W @ Max WL, side slope Z:1)</option>
          <option value="circ">Circular (Upper Diameter @ Max WL, side slope Z:1)</option>
        </select>
      </div>

      <div id="rectBox" class="grid2">
        <div>
          <label>Upper Length @ Max WL (m)</label>
          <input id="ltop" type="number" step="0.1" value="50" min="0.1">
        </div>
        <div>
          <label>Upper Width @ Max WL (m)</label>
          <input id="wtop" type="number" step="0.1" value="40" min="0.1">
        </div>
        <div>
          <label>Side slope Z:1 (H:V)</label>
          <input id="z" type="number" step="0.1" value="3" min="0">
        </div>
      </div>

      <div id="circBox" class="grid2" style="display:none">
        <div>
          <label>Upper Diameter @ Max WL (m)</label>
          <input id="dtop" type="number" step="0.1" value="40" min="0.1">
        </div>
        <div>
          <label>Side slope Z:1 (H:V)</label>
          <input id="zc" type="number" step="0.1" value="3" min="0">
        </div>
      </div>

      <div class="row" style="margin-top:10px">
        <button id="run">CALCULATE</button>
      </div>

      <div id="msg" class="msg">Ready.</div>

      <div class="kpis">
        <div class="kpi"><div class="t">Pond Bottom (m)</div><div id="kBottom" class="v">–</div></div>
        <div class="kpi"><div class="t">Max Water Level (m)</div><div id="kMaxWL" class="v">–</div></div>
        <div class="kpi"><div class="t">Available Depth (m)</div><div id="kDepth" class="v">–</div></div>

        <div class="kpi"><div class="t">Upper Length @ Max WL (m)</div><div id="kTopL" class="v">–</div></div>
        <div class="kpi"><div class="t">Upper Width @ Max WL (m)</div><div id="kTopW" class="v">–</div></div>
        <div class="kpi"><div class="t">Upper Diameter @ Max WL (m)</div><div id="kTopD" class="v">–</div></div>

        <div class="kpi"><div class="t">Lower Length (Bottom) (m)</div><div id="kLowL" class="v">–</div></div>
        <div class="kpi"><div class="t">Lower Width (Bottom) (m)</div><div id="kLowW" class="v">–</div></div>
        <div class="kpi"><div class="t">Lower Diameter (Bottom) (m)</div><div id="kLowD" class="v">–</div></div>

        <div class="kpi"><div class="t">Total Storage @ Max WL (m³)</div><div id="kVtot" class="v">–</div></div>
        <div class="kpi"><div class="t">Storage Below IL (m³)</div><div id="kVbelow" class="v">–</div></div>
        <div class="kpi"><div class="t">Storage IL → Max WL (m³)</div><div id="kVactive" class="v">–</div></div>

        <div class="kpi"><div class="t">Required Volume (m³)</div><div id="kVreq" class="v">–</div></div>
        <div class="kpi"><div class="t">Storage Check</div><div id="kPass" class="v">–</div></div>
        <div class="kpi"><div class="t">Runoff/ Inflow Note</div><div id="kNote" class="v">–</div></div>
      </div>
    </div>

    <p class="muted" style="font-size:12px">
      Rectangular: Lb = Ltop − 2·Z·H, Wb = Wtop − 2·Z·H.<br>
      Circular: r0 = (Dtop/2) − Z·H, Dbottom = 2·r0.<br>
      If lower dimension becomes ≤ 0 → message: “Increase the pond dimension”.
    </p>
  </div>

<script>
  const $ = id => document.getElementById(id);
  const fmt = (x,d=2)=> (isFinite(x)? Number(x).toFixed(d):"–");

  function scsRunoffMm(Pmm, CN){
    const S_in = (1000/CN) - 10;
    const S_mm = S_in * 25.4;
    const Ia = 0.2 * S_mm;
    if(Pmm <= Ia) return 0;
    return Math.max(0, ((Pmm - Ia)**2) / (Pmm + 0.8*S_mm));
  }

  function pondVolumeRect(Lb, Wb, Z, H){
    return (Lb*Wb*H) + (Z*(Lb+Wb)*H*H) + ((4/3)*Z*Z*H*H*H);
  }

  function pondVolumeCirc(r0, Z, H){
    return Math.PI*(r0*r0*H + r0*Z*H*H + (Z*Z/3)*H*H*H);
  }

  function toggleMode(){
    const m = $("mode").value;
    $("scsBox").style.display    = (m==="scs") ? "grid" : "none";
    $("inflowBox").style.display = (m==="inflow") ? "grid" : "none";
    $("volBox").style.display    = (m==="vol") ? "grid" : "none";
  }

  function toggleShape(){
    const s = $("shape").value;
    $("rectBox").style.display = (s==="rect") ? "grid" : "none";
    $("circBox").style.display = (s==="circ") ? "grid" : "none";
  }

  function setPassColor(isPass){
    const el = $("kPass");
    el.classList.remove("pass","fail");
    el.classList.add(isPass ? "pass" : "fail");
  }

  function clampPct(x){ return Math.min(Math.max(x,0),50); }

  function calc(){
    try{
      // Levels
      const egl = Number($("egl").value);
      const il  = Number($("il").value);
      let below = Number($("belowIL").value);
      const fb  = Number($("fb").value);

      if(!isFinite(egl)||!isFinite(il)||!isFinite(below)||!isFinite(fb)) throw new Error("Check levels inputs.");
      if(below < 0.30) below = 0.30;
      $("belowIL").value = below.toFixed(2);

      const bottom = il - below;
      const maxWL  = egl - fb;
      const H = maxWL - bottom;
      if(!(H>0)) throw new Error("Invalid: (EGL - FB) must be above (IL - below).");

      // Geometry (user inputs UPPER dims, compute LOWER dims)
      const shape = $("shape").value;

      let Vtot = 0;
      let Vbelow = 0;

      // Display values
      let topL = NaN, topW = NaN, topD = NaN;
      let lowL = NaN, lowW = NaN, lowD = NaN;

      if(shape === "rect"){
        topL = Number($("ltop").value);
        topW = Number($("wtop").value);
        const Z  = Number($("z").value);

        if(!(topL>0 && topW>0 && Z>=0)) throw new Error("Check rectangular upper dimensions and side slope.");

        // Compute bottom dims
        lowL = topL - 2*Z*H;
        lowW = topW - 2*Z*H;

        if(!(lowL > 0 && lowW > 0)){
          throw new Error("Increase the pond dimension (upper L/W too small for this depth and side slope).");
        }

        Vtot = pondVolumeRect(lowL, lowW, Z, H);

        // storage below IL (depth = belowIL)
        const Hbelow = Math.max(0, il - bottom);
        if(Hbelow > 0){
          const hUse = Math.min(Hbelow, H);
          Vbelow = pondVolumeRect(lowL, lowW, Z, hUse);
        }
      } else {
        topD = Number($("dtop").value);
        const Z  = Number($("zc").value);

        if(!(topD>0 && Z>=0)) throw new Error("Check circular upper diameter and side slope.");

        // Compute bottom radius from top radius
        const rTop = topD/2;
        const r0 = rTop - Z*H;

        if(!(r0 > 0)){
          throw new Error("Increase the pond dimension (upper diameter too small for this depth and side slope).");
        }

        lowD = 2*r0;

        Vtot = pondVolumeCirc(r0, Z, H);

        const Hbelow = Math.max(0, il - bottom);
        if(Hbelow > 0){
          const hUse = Math.min(Hbelow, H);
          Vbelow = pondVolumeCirc(r0, Z, hUse);
        }
      }

      const Vactive = Math.max(0, Vtot - Vbelow);

      // Required volume
      const mode = $("mode").value;
      let Vreq = 0;
      let note = "";

      if(mode==="scs"){
        const areaHa = Number($("areaHa").value);
        const cn = Number($("cn").value);
        const pmm = Number($("pmm").value);
        const loss = clampPct(Number($("lossPct").value || 0));
        if(!(areaHa>0 && cn>=30 && cn<=98 && pmm>=0)) throw new Error("Check SCS inputs.");

        const qmm = scsRunoffMm(pmm, cn);
        const areaM2 = areaHa * 10000;
        Vreq = (qmm/1000) * areaM2;
        Vreq *= (1 - loss/100);
        note = `SCS runoff depth ≈ ${fmt(qmm,1)} mm`;
      }
      else if(mode==="inflow"){
        const Qp = Number($("qp").value);
        const Tp = Number($("tp").value);
        const Tb = Number($("tb").value);
        const loss = clampPct(Number($("lossPct2").value || 0));
        if(!(Qp>=0 && Tp>0 && Tb>0 && Tb>=Tp)) throw new Error("Check inflow inputs (Tb ≥ Tp).");

        Vreq = 0.5 * Qp * (Tb*60);
        Vreq *= (1 - loss/100);
        note = `Triangular inflow volume from Qp & Tb`;
      }
      else {
        const vuser = Number($("vreqUser").value);
        const loss = clampPct(Number($("lossPct3").value || 0));
        if(!(vuser>=0)) throw new Error("Enter a valid required volume (m³).");
        Vreq = vuser * (1 - loss/100);
        note = `Direct required volume (after loss)`;
      }

      const pass = (Vtot >= Vreq);

      // KPIs
      $("kBottom").textContent = fmt(bottom,2);
      $("kMaxWL").textContent = fmt(maxWL,2);
      $("kDepth").textContent  = fmt(H,2);

      $("kTopL").textContent = isFinite(topL) ? fmt(topL,2) : "–";
      $("kTopW").textContent = isFinite(topW) ? fmt(topW,2) : "–";
      $("kTopD").textContent = isFinite(topD) ? fmt(topD,2) : "–";

      $("kLowL").textContent = isFinite(lowL) ? fmt(lowL,2) : "–";
      $("kLowW").textContent = isFinite(lowW) ? fmt(lowW,2) : "–";
      $("kLowD").textContent = isFinite(lowD) ? fmt(lowD,2) : "–";

      $("kVtot").textContent   = fmt(Vtot,0);
      $("kVbelow").textContent = fmt(Vbelow,0);
      $("kVactive").textContent= fmt(Vactive,0);

      $("kVreq").textContent   = fmt(Vreq,0);
      $("kPass").textContent   = pass ? "PASS" : "FAIL";
      setPassColor(pass);

      $("kNote").textContent   = note;

      $("msg").textContent = pass
        ? "PASS: Pond storage at max WL is ≥ required volume."
        : "FAIL: Increase pond size or revise assumptions.";

    } catch(e){
      $("msg").textContent = e.message || String(e);

      // Clear pass indicator
      $("kPass").textContent = "–";
      $("kPass").classList.remove("pass","fail");
    }
  }

  $("mode").addEventListener("change", toggleMode);
  $("shape").addEventListener("change", toggleShape);
  $("run").addEventListener("click", calc);

  toggleMode();
  toggleShape();
</script>
</body>
</html>
